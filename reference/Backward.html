<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Propagate a backward table — Backward • kalis</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/PT_Serif-0.4.9/font.css" rel="stylesheet"><link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet"><link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Propagate a backward table — Backward"><meta name="description" content="Propagates a kalisBackwardTable to an upstream variant.
The table is updated in-place."><meta property="og:description" content="Propagates a kalisBackwardTable to an upstream variant.
The table is updated in-place."><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">kalis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Decoding_a_Single_Variant.html">Decoding a Single Variant</a></li>
    <li><a class="dropdown-item" href="../articles/Iterating_Over_Loci.html">Iterating Over Loci</a></li>
    <li><a class="dropdown-item" href="../articles/lct_example.html">Reproducing kalis Paper LCT Example</a></li>
    <li><a class="dropdown-item" href="../articles/Reading_Haplotype_Data.html">Reading Haplotype Data</a></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://doi.org/10.1186/s12859-024-05688-8">BMC Bioinformatics Paper</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/louisaslett/kalis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Propagate a backward table</h1>
      <small class="dont-index">Source: <a href="https://github.com/louisaslett/kalis/blob/master/R/FB.R" class="external-link"><code>R/FB.R</code></a></small>
      <div class="d-none name"><code>Backward.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Propagates a <code>kalisBackwardTable</code> to an upstream variant.
The table is updated in-place.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Backward</span><span class="op">(</span></span>
<span>  <span class="va">bck</span>,</span>
<span>  <span class="va">pars</span>,</span>
<span>  t <span class="op">=</span> <span class="va">bck</span><span class="op">$</span><span class="va">l</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  nthreads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span>logical <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="va">bck</span><span class="op">$</span><span class="va">to_recipient</span> <span class="op">-</span></span>
<span>    <span class="va">bck</span><span class="op">$</span><span class="va">from_recipient</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  beta.theta <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-bck">bck<a class="anchor" aria-label="anchor" href="#arg-bck"></a></dt>
<dd><p>a <code>kalisBackwardTable</code> object, as returned by
<code><a href="MakeBackwardTable.html">MakeBackwardTable()</a></code>.</p></dd>


<dt id="arg-pars">pars<a class="anchor" aria-label="anchor" href="#arg-pars"></a></dt>
<dd><p>a <code>kalisParameters</code> object, as returned by
<code><a href="Parameters.html">Parameters()</a></code>.</p></dd>


<dt id="arg-t">t<a class="anchor" aria-label="anchor" href="#arg-t"></a></dt>
<dd><p>a variant to move the backward table to.
Must be less than or equal to current variant of <code>bck</code>.
By default, it advances to the next variant upstream (or if an uninitialised table, to the last variant).</p></dd>


<dt id="arg-nthreads">nthreads<a class="anchor" aria-label="anchor" href="#arg-nthreads"></a></dt>
<dd><p>if a scalar, the number of CPU cores to use.
If a vector, launch as many threads as the length of the vector and attempt to pin the threads to those CPU cores (requires system to support thread affinity).
By default uses the <code>parallel</code> package to detect the number of physical cores.</p></dd>


<dt id="arg-beta-theta">beta.theta<a class="anchor" aria-label="anchor" href="#arg-beta-theta"></a></dt>
<dd><p>logical indicating whether the table should be returned in beta-theta space or in the standard space upon reaching the target variant <code>t</code>.
See the Details section.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>There is nothing returned.</p>
<p><strong>NOTE:</strong> for performance reasons, <code>bck</code> is updated in-place.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>Backward</code> implements the backward algorithm to propagate the Li and Stephens rescaled hidden Markov model backward probabilities to a new target
variant.
Naturally, this can only propagate a table to variants upstream of its current position.</p>
<p>For mathematical details please see Section 2 of the kalis paper (Aslett and Christ, 2024).
Note that the precise formulation of the backward equation is determined by whether the flag <code>use.spiedel</code> is set in the parameters provided in <code>pars</code>.</p>
<p><strong>Beta-theta space</strong></p>
<p>The rescaled HMM backward probabilities incorporate all of the haplotype relatedness information downstream from but NOT including the target variant, as is standard in the definition of HMM backward probabilities – we refer to this as "beta space", or "rescaled probability space."
In contrast, the rescaled forward probabilities, naturally incorporate all of the haplotype relatedness information upstream from AND including the target variant.
Setting <code>beta.theta = TRUE</code> incorporates the target variant (analogous to the rescaled forward probabilities) – we refer to this as "beta-theta space."</p>
<p>A backward table in beta-theta space (with <code>beta.theta = TRUE</code>) can be propagated to an upstream variant without incorporating that variant, thereby moving to beta space (<code>beta.theta = FALSE</code>), and vice versa.
However, while a backward table in beta space (<code>beta.theta = FALSE</code>) can be updated to incorporate the current variant, a backward table that is already in beta-theta space can not move to beta space without changing variants – that would involve "forgetting" the current variant (see Examples).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Aslett, L.J.M. and Christ, R.R. (2024) "kalis: a modern implementation of the Li &amp; Stephens model for local ancestry inference in R", <em>BMC Bioinformatics</em>, <strong>25</strong>(1). Available at: <a href="https://doi.org/10.1186/s12859-024-05688-8" class="external-link">doi:10.1186/s12859-024-05688-8</a>
.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="MakeBackwardTable.html">MakeBackwardTable()</a></code> to generate a backward table;
<code><a href="Forward.html">Forward()</a></code> for the analogous forward propagation function;
<code><a href="CopyTable.html">CopyTable()</a></code> to create a copy of table.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Load the toy haplotype example and set toy parameters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SmallHaps"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SmallMap"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="CacheHaplotypes.html">CacheHaplotypes</a></span><span class="op">(</span><span class="va">SmallHaps</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="CalcRho.html">CalcRho</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">SmallMap</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="Parameters.html">Parameters</a></span><span class="op">(</span><span class="va">rho</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create the backward table we want to propagate</span></span></span>
<span class="r-in"><span><span class="va">bck</span> <span class="op">&lt;-</span> <span class="fu"><a href="MakeBackwardTable.html">MakeBackwardTable</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calling Backward on this uninitialised table moves it to the last variant</span></span></span>
<span class="r-in"><span><span class="fu">Backward</span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bck</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Backward Table object for 300 haplotypes, in rescaled probability space. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Current variant = 400 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory consumed: 724.13 kB </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># And again moves it to the next variant (etcetera)</span></span></span>
<span class="r-in"><span><span class="fu">Backward</span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bck</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Backward Table object for 300 haplotypes, in rescaled probability space. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Current variant = 399 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory consumed: 724.13 kB </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or zoom to a particular variant</span></span></span>
<span class="r-in"><span><span class="fu">Backward</span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span>, <span class="fl">150</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bck</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Backward Table object for 300 haplotypes, in rescaled probability space. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Current variant = 150 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory consumed: 724.13 kB </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now moving to variant 125 AND specifying "beta space" (though this is the</span></span></span>
<span class="r-in"><span><span class="co"># default, just being very clear)</span></span></span>
<span class="r-in"><span><span class="fu">Backward</span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span>, <span class="fl">125</span>, beta.theta <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bck</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Backward Table object for 300 haplotypes, in rescaled probability space. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Current variant = 125 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory consumed: 724.13 kB </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now just moving to "beta-theta space" (can be done with or without</span></span></span>
<span class="r-in"><span><span class="co"># propagating to a new variant)</span></span></span>
<span class="r-in"><span><span class="fu">Backward</span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span>, <span class="fl">125</span>, beta.theta <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">bck</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Backward Table object for 300 haplotypes, in beta-theta space. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Current variant = 125 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory consumed: 724.13 kB </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># However, attempting to move from "beta-theta space" back to "beta space"</span></span></span>
<span class="r-in"><span><span class="co"># without propagating is not possible (see Details).</span></span></span>
<span class="r-in"><span><span class="co"># The following will give an error (hence wrapped in try())</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">Backward</span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span>, <span class="fl">125</span>, beta.theta <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in Backward(bck, pars, 125, beta.theta = FALSE) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Cannot move from beta-theta space to beta space without moving at least one variant.</span>
<span class="r-in"><span><span class="va">bck</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Backward Table object for 300 haplotypes, in beta-theta space. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Current variant = 125 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Memory consumed: 724.13 kB </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Louis Aslett, Ryan Christ.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

