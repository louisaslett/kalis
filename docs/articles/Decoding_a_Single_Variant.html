<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="kalis">
<title>Decoding a Single Variant â€¢ kalis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/PT_Serif-0.4.4/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.4/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.4/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decoding a Single Variant">
<meta property="og:description" content="kalis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">kalis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.91.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Decoding_a_Single_Variant.html">Decoding a Single Variant</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/louisaslett/kalis/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Decoding a Single Variant</h1>
                        <h4 data-toc-skip class="author">Louis Aslett
&amp; Ryan Christ</h4>
            
            <h4 data-toc-skip class="date">2022-12-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/louisaslett/kalis/blob/HEAD/vignettes/Decoding_a_Single_Variant.Rmd" class="external-link"><code>vignettes/Decoding_a_Single_Variant.Rmd</code></a></small>
      <div class="d-none name"><code>Decoding_a_Single_Variant.Rmd</code></div>
    </div>

    
    
<p>In order to demonstrate how to use to calculate and plot a local
distance matrix <span class="math inline">\(d^{\ell}\)</span>, the
package comes with an toy dataset of 300 simulated haplotypes, , stored
as a <span class="math inline">\(L = 400\)</span> by <span class="math inline">\(N = 300\)</span> .</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://kalis.louisaslett.com/">kalis</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: kalis</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Running in 64-bit mode using x86-64 architecture.</span></span>
<span><span class="co">#&gt; Loops unrolled to depth 4.</span></span>
<span><span class="co">#&gt; Currently using AVX2, AVX, SSE4.1, SSE2, FMA and BMI2 CPU instruction set extensions.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"SmallHaps"</span><span class="op">)</span></span></code></pre></div>
<p> maintains a special cache for loading a haplotype dataset (see next
section for details). Since is designed for much larger datasets than
this toy example that we would often never want load into , haplotypes
can be imported directly into the cache using . can only cache and
operate on one haplotype dataset at a time. Currently, requires that the
haplotypes be stored in our custom HDF5 format but support for other
common formats will be added shortly. In the following section we
provide simple instructions for converting common file formats like VCFs
and HAP/SAMPLE/LEGEND generated by SHAPEIT2 to our HDF5 format. However,
if the haplotypes are loaded into a , we can easily import them straight
into the cache using .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CacheHaplotypes.html">CacheHaplotypes</a></span><span class="op">(</span><span class="va">SmallHaps</span><span class="op">)</span></span></code></pre></div>
<p>From we can inspect the haplotype cache to ensure that the data has
loaded correctly using . With the haplotypes loaded, next we must
specify our model parameters. First we supply a recombination map, <span class="math inline">\(m\)</span>, where <span class="math inline">\(m^\ell\)</span> is the distance between variant
<span class="math inline">\(\ell\)</span> and <span class="math inline">\(\ell + 1\)</span> in Morgans. Here we randomly
generate a recombination map and set the remaining parameters to their
default values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span><span class="op">(</span><span class="fl">400</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">1e-6</span></span>
<span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Parameters.html">Parameters</a></span><span class="op">(</span><span class="fu"><a href="../reference/CalcRho.html">CalcRho</a></span><span class="op">(</span>cM <span class="op">=</span> <span class="va">m</span>, s <span class="op">=</span> <span class="fl">1</span>, gamma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, mu <span class="op">=</span> <span class="fl">1e-8</span><span class="op">)</span></span></code></pre></div>
<p>Next we must initialize a forward table object with our parameters
that will start at variant <span class="math inline">\(0\)</span> and a
backward table object that will start at the variant <span class="math inline">\(L+1\)</span>. We then use the function to
propagate the forward table using parameters to target variant <span class="math inline">\(250\)</span>. We do the same with the backward
table using the function. Note that and do not return anything, the
tables and are updated in place.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MakeForwardTable.html">MakeForwardTable</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span><span class="va">bck</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MakeBackwardTable.html">MakeBackwardTable</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/Forward.html">Forward</a></span><span class="op">(</span><span class="va">fwd</span>, <span class="va">pars</span>, <span class="fl">250</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Backward.html">Backward</a></span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span>, <span class="fl">250</span><span class="op">)</span></span></code></pre></div>
<p>Now that and are at the same variant, they can be combined to obtain
the posterior marginal copying probabilities, <span class="math inline">\(p^\ell\)</span>, or a matrix of distances based on
the negative log of those copying probabilities, <span class="math inline">\(d^\ell\)</span>, as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PostProbs.html">PostProbs</a></span><span class="op">(</span><span class="va">fwd</span>,<span class="va">bck</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/DistMat.html">DistMat</a></span><span class="op">(</span><span class="va">fwd</span>,<span class="va">bck</span><span class="op">)</span></span></code></pre></div>
<p>The distance matrix can be easily clustered and visualized just by
calling</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in levelplot.formula(form, data, aspect = aspect, xlim = xlim, ylim =</span></span>
<span><span class="co">#&gt; ylim, : device support for raster images unknown, ignoring 'raster=TRUE'</span></span></code></pre></div>
<p><img src="Decoding_a_Single_Variant_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>In some applications, one might want to symmetrize the matrix before
plotting as follows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">0.5</span><span class="op">*</span><span class="op">(</span><span class="va">d</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in levelplot.formula(form, data, aspect = aspect, xlim = xlim, ylim =</span></span>
<span><span class="co">#&gt; ylim, : device support for raster images unknown, ignoring 'raster=TRUE'</span></span></code></pre></div>
<p><img src="Decoding_a_Single_Variant_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Louis Aslett, Ryan Christ.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
