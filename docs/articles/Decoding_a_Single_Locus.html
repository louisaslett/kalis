<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Decoding a Single Locus â€¢ kalis</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Decoding a Single Locus">
<meta property="og:description" content="kalis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kalis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AutoTuning.html">Auto-tuning HMM Parameters for Local Phylogeny Inference</a>
    </li>
    <li>
      <a href="../articles/Decoding_a_Single_Locus.html">Decoding a Single Locus</a>
    </li>
    <li>
      <a href="../articles/SimpleGWAS.html">SimpleGWAS</a>
    </li>
    <li>
      <a href="../articles/testing_new_dedip.html">testing_new_dedip</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Decoding_a_Single_Locus_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="Decoding_a_Single_Locus_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Decoding_a_Single_Locus_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Decoding a Single Locus</h1>
                        <h4 class="author">Louis Aslett &amp; Ryan Christ</h4>
            
            <h4 class="date">2021-01-02</h4>
      
      
      <div class="hidden name"><code>Decoding_a_Single_Locus.Rmd</code></div>

    </div>

    
    
<p>In order to demonstrate how to use  to calculate and plot a local distance matrix <span class="math inline">\(d^{\ell}\)</span>, the package comes with an toy dataset of 100 simulated haplotypes, , stored as a <span class="math inline">\(L = 500\)</span> by <span class="math inline">\(N=100\)</span> .</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va">kalis</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: kalis</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Running in 64-bit mode using x86-64 architecture.</span>
<span class="co">#&gt; Loops unrolled to depth 4.</span>
<span class="co">#&gt; Currently using SSE2, SSE4.1, AVX, AVX2, FMA and BMI2 CPU instruction set extensions.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SmallHaps"</span><span class="op">)</span></code></pre></div>
<p> maintains a special cache for loading a haplotype dataset (see next section for details). Since  is designed for much larger datasets than this toy example that we would often never want load into , haplotypes can be imported directly into the  cache using .  can only cache and operate on one haplotype dataset at a time. Currently,  requires that the haplotypes be stored in our custom HDF5 format but support for other common formats will be added shortly. In the following section we provide simple instructions for converting common file formats like VCFs and HAP/SAMPLE/LEGEND generated by SHAPEIT2 to our HDF5 format. However, if the haplotypes are loaded into a  , we can easily import them straight into the  cache using .</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/CacheHaplotypes.html">CacheHaplotypes</a></span><span class="op">(</span><span class="va">SmallHaps</span><span class="op">)</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>From  we can inspect the haplotype cache to ensure that the data has loaded correctly using . With the haplotypes loaded, next we must specify our model parameters. First we supply a recombination map, <span class="math inline">\(m\)</span>, where <span class="math inline">\(m^\ell\)</span> is the distance between locus <span class="math inline">\(\ell\)</span> and <span class="math inline">\(\ell + 1\)</span> in Morgans. Here we randomly generate a recombination map and set the remaining parameters to their default values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">500</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span><span class="op">*</span><span class="fl">1e-6</span>
<span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Parameters.html">Parameters</a></span><span class="op">(</span><span class="fu"><a href="../reference/CalcRho.html">CalcRho</a></span><span class="op">(</span>cM <span class="op">=</span> <span class="va">m</span>, s <span class="op">=</span> <span class="fl">1</span>, gamma <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, mu <span class="op">=</span> <span class="fl">1e-8</span><span class="op">)</span></code></pre></div>
<p>Next we must initialize a forward table object with our parameters that will start at locus <span class="math inline">\(0\)</span> and a backward table object that will start at the locus <span class="math inline">\(L+1\)</span>. We then use the function  to propagate the forward table  using parameters  to target locus <span class="math inline">\(250\)</span>. We do the same with the backward table using the  function. Note that  and  do not return anything, the tables  and  are updated in place.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MakeForwardTable.html">MakeForwardTable</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span>
<span class="va">bck</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MakeBackwardTable.html">MakeBackwardTable</a></span><span class="op">(</span><span class="va">pars</span><span class="op">)</span>

<span class="fu"><a href="../reference/Forward.html">Forward</a></span><span class="op">(</span><span class="va">fwd</span>, <span class="va">pars</span>, <span class="fl">250</span><span class="op">)</span>
<span class="fu"><a href="../reference/Backward.html">Backward</a></span><span class="op">(</span><span class="va">bck</span>, <span class="va">pars</span>, <span class="fl">250</span><span class="op">)</span></code></pre></div>
<p>Now that  and  are at the same locus, they can be combined to obtain <span class="math inline">\(p^\ell\)</span> or <span class="math inline">\(d^\ell\)</span> as follows.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">#p &lt;- PostProbs(fwd,bck)</span>
<span class="co">#M &lt;- DistMat(fwd,bck)</span></code></pre></div>
<p>The distance matrix can be easily clustered and visualized just by calling</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#plot(M)</span></code></pre></div>
<p>In some applications, one might want to symmetrize the matrix before plotting as follows.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#M &lt;- 0.5*(M + t(M))</span>
<span class="co">#plot(M)</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Louis Aslett, Ryan Christ.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
