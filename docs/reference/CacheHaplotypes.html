<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Load haplotypes into package memory space — CacheHaplotypes • kalis</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Load haplotypes into package memory space — CacheHaplotypes" />
<meta property="og:description" content="Load haplotypes from hard drive or an R matrix into an optimized kalis package memory space (overwrites any previous load)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kalis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Decoding_a_Single_Locus.html">Decoding a Single Locus</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/louisaslett/kalis/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Load haplotypes into package memory space</h1>
    <small class="dont-index">Source: <a href='https://github.com/louisaslett/kalis/blob/master/R/CacheHaplotypes.R'><code>R/CacheHaplotypes.R</code></a></small>
    <div class="hidden name"><code>CacheHaplotypes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Load haplotypes from hard drive or an R matrix into an optimized kalis package memory space (overwrites any previous load).</p>
    </div>

    <pre class="usage"><span class='fu'>CacheHaplotypes</span><span class='op'>(</span>
  <span class='va'>haps</span>,
  loci.idx <span class='op'>=</span> <span class='cn'>NULL</span>,
  hap.idx <span class='op'>=</span> <span class='cn'>NULL</span>,
  warn.singletons <span class='op'>=</span> <span class='cn'>TRUE</span>,
  format <span class='op'>=</span> <span class='st'>"auto"</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>haps</th>
      <td><p>can be the name of a file from which the haplotypes are to be
read, or can be an R matrix containing only 0/1s.
See Details section for supported file types.</p></td>
    </tr>
    <tr>
      <th>loci.idx</th>
      <td><p>an optional vector of indicies specifying the loci to load
into the cache, indexed from 1.</p></td>
    </tr>
    <tr>
      <th>hap.idx</th>
      <td><p>an optional vector of incidies specifying the haplotypes to load
into the cache, indexed from 1.</p></td>
    </tr>
    <tr>
      <th>warn.singletons</th>
      <td><p>a logical, if <code>FALSE</code>, suppress warning that singletons (variants where there is only one 1 or only one 0) are present in the loaded <code>haps</code>.  Defaults to <code>TRUE</code>.  See Details.</p></td>
    </tr>
    <tr>
      <th>format</th>
      <td><p>the file format that <code>haps</code> is stored in, or <code>"auto"</code> to
detect the format based on the file extension.  Recognised options are <code>"hapgz"</code> (format used by IMPUTE2 and SHAPEIT) or
<code>"hdf5"</code> (custom).  See Details section for more information and easy conversion from VCF/BCF and other formats.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>format specific options for reading in <code>haps</code>.  Supported optional arguments are:</p><ol>
<li><p>hapgz</p><ul>
<li><p><code>legendgz.file</code> a string for faster loading: a legendgz file can be supplied and will be used
to more efficiently determine the number of variants in the hapgz file</p></li>
<li><p><code>L</code> an integer for faster loading: the number of variants in the hapgz file can be directly provided</p></li>
<li><p><code>N</code> an integer for faster loading: the number of haplotypes in the hapgz file can be directly provided</p></li>
</ul></li>
<li><p>hdf5</p><ul>
<li><p><code>transpose</code> a logical, if <code>TRUE</code>, switch the interpretation of rows and columns in <code>haps</code>:
hence switching the number of haplotypes and the number of variants (the HDF5 specification does not
prescribe row/column interpretation, only defining the
slowest changing dimension as 'first'). Defaults to <code>FALSE</code>.</p></li>
<li><p><code>haps.path</code> a string giving the path to a 2-dimensional object in the
HDF5 file specifying the haplotype matrix.  Defaults to <code>/haps</code></p></li>
<li><p><code>hdf5.pkg</code> a string giving the HDF5 R package to use to load the file
from disk.  The packages <code>rhdf5</code> (BioConductor) and <code>hdf5r</code> (CRAN)
are both supported.  Default is to use <code>hdf5r</code> if both packages are
available, with fallback to <code>rhdf5</code>.  This should never need to be
specified unless you have both packages but want to force the use of
the <code>rhdf5</code> package.</p></li>
</ul></li>
<li><p>R matrix</p><ul>
<li><p><code>transpose</code> a logical, if <code>TRUE</code>, switch the interpretation of rows and columns in <code>haps</code>:
hence switching the number of haplotypes and the number of variants.  Defaults to <code>FALSE</code>, meaning loci are taken to
be in rows with haplotypes in columns (ie a num loci x num haps matrix)</p></li>
</ul></li>
</ol></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Nothing is returned by the function.
It is highly recommended that you run <code><a href='CacheSummary.html'>CacheSummary</a></code> after <code>CacheHaplotypes</code>, especially if you are uncertain about the interpretation of rows and columns in <code>haps</code>.
If <code><a href='CacheSummary.html'>CacheSummary</a></code> shows that the number of haplotypes and variants are reversed, try calling <code>CacheHaplotypes</code> again with the extra argument <code>transpose = TRUE</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>To achieve higher performance, kalis internally represents haplotypes
in an efficient raw binary format in memory.  This function will load
haplotypes from a file or from a binary R matrix and convert this into kalis'
internal format ready for use by the other functions in this package.  Note
that only one set of haplotypes can be cached at a time and calling this
function twice overwrites cache of haplotypes created by the first function
call.</p>
<p>Including singletons (variants where there is only one 1 or only one 0) in the loaded haplotypes can lead to numerical instability and
columns of NaNs in the resulting forward and backward tables when <code>mu</code> (see <code><a href='Parameters.html'>Parameters</a></code>) is small.  Thus, <code>kalis</code> throws a warning when loaded haplotypes contain singletons.</p>
<p>At present, hap.gz and hdf5 are supported natively, see example below showing how to convert from a VCF/BCF to hap.gz with one <code>bcftools</code> command.</p>
<p><strong>hap.gz format</strong></p>
<p>This is the HAP/LEGEND/SAMPLE format used by IMPUTE2 and SHAPEIT.  Only the <code>.hap.gz</code> file is required for loading with <code>CacheHaplotypes</code> though the <code>.legend.gz</code> file can speed up reading the haplotypes.
See http://samtools.github.io/bcftools/bcftools.html#convert for more details on this format.</p>
<p><strong>R matrix</strong></p>
<p>If supplying an R matrix, it must consist of only 0's or 1's.  The haplotypes
should be stored in columns, with variants in rows.  That is, the dimensions
should be:</p>
<p>(num rows)x(num cols) = (num variants)x(num haplotypes).</p>
<p>It is fine to delete this matrix after calling <code>CacheHaplotypes</code>.</p>
<p><strong>HDF5 format</strong></p>
<p>For HDF5 files, kalis expects a 2-dimensional object named <code>haps</code> at the root
level of the HDF5 file.  Haplotypes should be stored in the slowest changing
dimension as defined in the HDF5 specification (note that different languages
treat this as rows or columns).  If the haplotypes are stored in the other
dimension then simply set the argument <code>transpose = TRUE</code>.
If the user is unsure of the convention of the language they used to create
the HDF5 file, then the simplest approach is to simply load the data
specifying only the HDF5 file name and then confirm that number of haplotypes
and their length have not been exchanged in the diagnostic output which kalis
prints.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='CacheSummary.html'>CacheSummary</a></code> for a list detailing the current cache status; <code><a href='QueryCache.html'>QueryCache</a></code> to copy the haplotypes in the <code>kalis</code> cache into an R matrix; <code><a href='ClearHaplotypeCache.html'>ClearHaplotypeCache</a></code> to remove the haplotypes from
the cache and free the memory; <code><a href='CacheSummary.html'>N</a></code> for the number of haplotypes cached; <code><a href='CacheSummary.html'>L</a></code> for the number of variants (loci) cached</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Examples</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>

<span class='co'># If starting from a VCF/BCF</span>
<span class='co'># first use bcftools to convert to HAP/SAMPLE/LEGEND format</span>
<span class='co'># (bcftools can take in several starting formats), see http://samtools.github.io/bcftools/bcftools.html#convert .</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.html'>system</a></span><span class='op'>(</span><span class='st'>"bcftools convert -h my.vcf.gz"</span><span class='op'>)</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='st'>"my.hap.gz"</span><span class='op'>)</span>
<span class='fu'><a href='CacheSummary.html'>CacheSummary</a></span><span class='op'>(</span><span class='op'>)</span>


<span class='co'># If starting directly from a hap.gz file on disk (HAP/LEGEND/SAMPLE format), see http://samtools.github.io/bcftools/bcftools.html#convert .</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='st'>"my.hap.gz"</span><span class='op'>)</span>
<span class='co'># eg: loading the mini example built into the package:</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"small_example/small.hap.gz"</span>, package <span class='op'>=</span> <span class='st'>"kalis"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='CacheSummary.html'>CacheSummary</a></span><span class='op'>(</span><span class='op'>)</span>


<span class='co'># If starting from a HDF5 file on disk</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='st'>"my.h5"</span><span class='op'>)</span>
<span class='co'># eg: loading the mini example built into the package:</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"small_example/small.h5"</span>, package <span class='op'>=</span> <span class='st'>"kalis"</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='CacheSummary.html'>CacheSummary</a></span><span class='op'>(</span><span class='op'>)</span>


<span class='co'># If CacheSummary() indicates that the numbers of</span>
<span class='co'># haplotypes and variants are the wrong way around, reload with</span>
<span class='co'># argument to transpose</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='st'>"myhaps.h5"</span>, transpose <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='CacheSummary.html'>CacheSummary</a></span><span class='op'>(</span><span class='op'>)</span>


<span class='co'># Alternatively, if you have an exotic file format that can be loaded in to</span>
<span class='co'># R by other means, then a binary matrix can be supplied.  This example</span>
<span class='co'># randomly simulated a binary matrix to illustrate (in reality load from</span>
<span class='co'># disk):</span>
<span class='va'>n.haps</span> <span class='op'>&lt;-</span> <span class='fl'>100</span>
<span class='va'>n.loci</span> <span class='op'>&lt;-</span> <span class='fl'>20000</span>
<span class='va'>haps</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, <span class='va'>n.haps</span><span class='op'>*</span><span class='va'>n.loci</span>, replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,
               nrow <span class='op'>=</span> <span class='va'>n.loci</span>,
               ncol <span class='op'>=</span> <span class='va'>n.haps</span><span class='op'>)</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='va'>haps</span><span class='op'>)</span>
<span class='co'># eg: loading the mini example built into the package:</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>SmallHaps</span><span class='op'>)</span>
<span class='fu'>CacheHaplotypes</span><span class='op'>(</span><span class='va'>SmallHaps</span><span class='op'>)</span>
<span class='op'>}</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Louis Aslett, Ryan Christ.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


